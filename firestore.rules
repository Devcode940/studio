
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if a user is authenticated.
    function isSignedIn() {
      return request.auth != null;
    }

    // Default to read-only for most collections, allows public access.
    // Writes are disallowed unless explicitly overridden.
    match /{document=**} {
      allow read: if true;
      allow write: if false;
    }

    // Allow authenticated users to write to county_gdp and census_data.
    // In a production app, you would restrict this to admin UIDs.
    match /county_gdp/{gdpId} {
      allow write: if isSignedIn();
    }

    match /census_data/{censusId} {
      allow write: if isSignedIn();
    }
    
    // Representatives and related subcollections
    match /representatives/{representativeId} {
      allow read: if true;
      allow write: if false; // Clients can't edit the main representative doc

      match /performance_metrics/{metricId} {
        allow read: if true;
        allow write: if isSignedIn(); // Logged-in users can add metrics
      }

      match /integrity_reports/{reportId} {
        allow read: if true;
        allow write: if false; // Should be managed by a backend process
      }

      match /highlights/{highlightId} {
        allow read: if true;
        allow write: if isSignedIn(); // Logged-in users can generate highlights
      }
    }

    // Leaderboard also remains read-only for clients.
    match /leaderboard_entries/{leaderboardEntryId} {
        allow read: if true;
        allow write: if false;
    }
  }
}
